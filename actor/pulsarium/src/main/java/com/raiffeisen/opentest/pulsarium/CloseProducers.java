package com.raiffeisen.opentest.pulsarium;

import com.raiffeisen.opentest.pulsarium.core.PulsariumTestAction;
import com.raiffeisen.opentest.pulsarium.exception.PulsariumConfigException;
import com.raiffeisen.opentest.pulsarium.exception.PulsariumProducerException;
import com.raiffeisen.opentest.pulsarium.util.connection.Producers;
import org.apache.pulsar.client.api.PulsarClientException;

import java.util.List;

import static java.lang.String.format;

public class CloseProducers extends PulsariumTestAction {

    @Override
    public void run() {
        super.run();

        List<String> producerNames = readArrayArgument("producers", List.class);

        for (String producerName : producerNames) {
            try {
                Producers.map.get(producerName).close();
            } catch (PulsarClientException e) {
                throw new PulsariumProducerException(format("Fail to close pulsar producer: %s", producerName), e);
            }
        }
    }
}
