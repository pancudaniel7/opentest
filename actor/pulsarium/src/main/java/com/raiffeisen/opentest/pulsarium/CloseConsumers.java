package com.raiffeisen.opentest.pulsarium;

import com.raiffeisen.opentest.pulsarium.core.PulsariumTestAction;
import com.raiffeisen.opentest.pulsarium.exception.PulsariumConsumerException;
import com.raiffeisen.opentest.pulsarium.util.connection.Consumers;
import org.apache.pulsar.client.api.PulsarClientException;

import java.util.List;

import static java.lang.String.format;

public class CloseConsumers extends PulsariumTestAction {

    @Override
    public void run() {
        super.run();

        List<String> consumerNames = readArrayArgument("consumers", List.class);

        for (String consumerName : consumerNames) {
            try {
                Consumers.map.get(consumerName).close();
            } catch (PulsarClientException e) {
                throw new PulsariumConsumerException(format("Fail to close pulsar consumer: %s", consumerName), e);
            }
        }
    }
}
