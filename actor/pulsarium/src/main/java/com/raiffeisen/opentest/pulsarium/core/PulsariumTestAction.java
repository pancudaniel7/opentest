package com.raiffeisen.opentest.pulsarium.core;

import com.raiffeisen.opentest.pulsarium.exception.PulsariumConfigException;
import org.apache.pulsar.client.api.PulsarClient;
import org.apache.pulsar.client.api.PulsarClientException;
import org.getopentest.base.TestAction;
import org.getopentest.util.Config;

public abstract class PulsariumTestAction extends TestAction {

    protected static PulsarClient client;

    static {
        try {
            Config config = Config.load("actor.yaml");
            String serviceUrl = config.getString("pulsarium.serviceUrl", "pulsar://localhost:6650");

            initPulsarClient(serviceUrl);
        } catch (PulsarClientException e) {
            throw new PulsariumConfigException("" +
                    "Fail to initiate Pulsar client, " +
                    "check if Pulsarium configs are set correctly " +
                    "or if Pulsar service can't be reached", e);
        }
    }

    private static void initPulsarClient(String url) throws PulsarClientException {
        client = PulsarClient.builder()
                .serviceUrl(url)
                .build();
    }
}
