package com.raiffeisen.opentest.pulsarium.util.builder;

import lombok.AccessLevel;
import lombok.NoArgsConstructor;
import org.apache.pulsar.client.api.Producer;
import org.apache.pulsar.client.api.TypedMessageBuilder;
import org.apache.pulsar.client.api.schema.GenericRecord;
import org.apache.pulsar.client.api.schema.GenericRecordBuilder;
import org.apache.pulsar.client.api.schema.GenericSchema;

import java.util.Map;

@NoArgsConstructor(access = AccessLevel.PRIVATE)
public class AvroMessageBuilder {
    public static TypedMessageBuilder<Object> build(Map<String, String> messages,
                                                    Producer<Object> producer,
                                                    GenericSchema<GenericRecord> schema) {

        GenericRecordBuilder recordBuilder = schema.newRecordBuilder();
        messages.forEach(recordBuilder::set);

        return producer.newMessage().value(recordBuilder.build());
    }
}
